<!DOCTYPE html>
<html lang="en">
    <head>
        <title>HEALPix Population</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                color: #808080;
                font-family:Monospace;
                font-size:13px;
                text-align:center;
                background-color: #ffffff;
                margin: 0px;
                overflow: hidden;
            }
            #info {
                position: absolute;
                top: 0px; width: 100%;
                padding: 5px;
            }
            a {
                color: #0080ff;
            }
            #ctrls{
                z-index:5;
                position: absolute;
                top: 10px; width: 200px;
                background-color: #aaaaaa;
                padding: 5px;
            }
        </style>
    </head>
    <body>
<div id="container">
<div id="ctrls">
<input type="button" value="Black Marble" onclick="showMyLayer(1);" />
<input type="button" value="HEALPix Pop" onclick="showMyLayer(2);" />
</div>
</div>

        <script src="js/three.js"></script>

        <script src="js/Projector.js"></script>
<script src="js/OrbitControls.js"></script>

        <script>
            var container;
            var camera, scene, renderer;
            var group;
            var controls;
            var windowHalfX = window.innerWidth / 2;
            var windowHalfY = window.innerHeight / 2;

            var RE = 200;
            var TORAD = Math.PI/180;
            var XAXIS = new THREE.Vector3(1,0,0);
            var YAXIS = new THREE.Vector3(0,1,0);
            var NINETYDEG = 90.0*TORAD;

            var l1mesh = null;
            var l2mesh = null;

            init();
            animate();

            function toVec(lat, lon)
            {
console.log(lat +","+lon);
                var clat = Math.cos(lat*TORAD);
                var slat = Math.sin(lat*TORAD);
                var clon = Math.cos(lon*TORAD);
                var slon = Math.sin(lon*TORAD);
console.log(clat +", "+slat+", "+clon+", "+slon);

                var x = RE*clat*clon;
                var y = RE*clat*slon;
                var z = RE*slat;
console.log(x+", "+ y+", "+ z);
                var v = new THREE.Vector3(x,y,z);
                v.applyAxisAngle(XAXIS,-NINETYDEG);
                return v;
            }

            function init() {
                container = document.getElementById( 'container' );
                camera = new THREE.PerspectiveCamera( 60, window.innerWidth / window.innerHeight, 1, 2000 );
                camera.position.z = 500;
                scene = new THREE.Scene();
                scene.background = new THREE.Color( 0x050505 );
                group = new THREE.Group();
                scene.add( group );
                // earth
                var loader = new THREE.TextureLoader();
                loader.load( 'images/BlackMarble_2016_3km_gray.jpg', function ( texture ) {
                    var geometry = new THREE.SphereBufferGeometry( RE, 200, 200 );
                    var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5, transparent: true, opacity:1 } );
                    var mesh = new THREE.Mesh( geometry, material );
                    l1mesh = mesh;
                    group.add( mesh );
                    addShapes();
                } );
                loader.load( 'images/hp10pop.png', function ( texture ) {
                    var geometry = new THREE.SphereBufferGeometry( RE, 200, 200 );
                    var material = new THREE.MeshBasicMaterial( { map: texture, overdraw: 0.5 , transparent: true, opacity:0.3} );
                    var mesh = new THREE.Mesh( geometry, material );
                    l2mesh = mesh;
                    group.add( mesh );
                } );

                renderer = new THREE.WebGLRenderer();
                renderer.setPixelRatio( window.devicePixelRatio );
                renderer.setSize( window.innerWidth, window.innerHeight );

	// controls
				controls = new THREE.OrbitControls( camera, renderer.domElement );
				//controls.addEventListener( 'change', render ); // call this only in static scenes (i.e., if there is no animation loop)
				controls.enableDamping = true; // an animation loop is required when either damping or auto-rotation are enabled
				controls.dampingFactor = 0.5;
				controls.screenSpacePanning = false;
				//controls.minDistance = 100;
				//controls.maxDistance = 500
				//controls.maxPolarAngle = Math.PI / 2;





                container.appendChild( renderer.domElement );
                window.addEventListener( 'resize', onWindowResize, false );
            }

            function showMyLayer(lnum)
            {
                var l1o = 0;
                var l2o = 0;
                var title = "";
                if(lnum == 1)
                {
                    l1o = 1;
                    l2o = 0;
                    title = "Black Marble - Nighttime Lights";
                }
                else if(lnum == 2)
                {
                    l1o = 0;
                    l2o = 1;
                    title = "HEALPix Bins of World Population from Geonames";
                }
                l1mesh.material.opacity=l1o;
                l2mesh.material.opacity=l2o;
                document.title = title;
                render();
            }

	    function onWindowResize() {
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}
            function animate() {
                requestAnimationFrame( animate );
controls.update();
                render();
            }
            function render() {
                renderer.render( scene, camera );
            }

            function addShapes()
            {
                /*
                var ptsGeometry = new THREE.Geometry();

                ptsGeometry.vertices.push(toVec(38,-77));                
                var mat = new THREE.PointsMaterial({color: 0xFF2222});
                var pts = new THREE.Points(ptsGeometry,mat);
                scene.add(pts);
                */
            }

        </script>

    </body>
</html>
